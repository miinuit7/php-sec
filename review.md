# PHP App ② レビュー

## XSS(クロスサイトスクリプティング)

### XSSとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

・Webページに不正なスクリプトを仕掛け、ページ開いたユーザーにスクリプトを実行させ、悪意のある別ページなどに強制遷移させること

【攻撃者のメリット】
・強制遷移させたページでユーザー情報を入力させ、メールアドレスやPWの情報を得る。
・遷移させたユーザーのcookie情報を得る。
・マルウェアに感染させスパム広告を大量に送ることにより、広告収入得たり、フィッシングサイトへの誘導ができる。

### `htmlspecialchars()`を`e()`として定義しなおすメリットを説明してください。

・htmlspecialcharsを再定義しなかった場合、別の箇所で使用したいという時に再度「htmlspecialchars（エスケープする文字列, エスケープの種類, 文字コード）」という長いコードを
再び記載しなくてはならない。あらかじめe()として再定義しておくことにより、再利用性が上がるかつ長いコードを都度書く必要がなくなるため可読性が上がる。

### `htmlspecialchars()`を使うことでなぜXSSが防げるのか説明してください。

htmlspecialcharsを使うことで「" ' > <」これらの別の文字列に変換させ、コードではなくテキストとして変換することができる。
変換されることによりフォーム上でスクリプトなどのコードを記載しても、コードとしてではなくテキストとして判定されるようになる。

## CSRF(クロスサイトリクエストフォージェリ)

### CSRFとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

・ログイン中のユーザーのセッションIDを利用し、不正リクエストを行うこと

【攻撃者のメリット】
・別ユーザーのPW変更などによる乗っ取り
・自分の素性を隠したまま、他人の情報を使い不正リクエストを行うことができる

### SessionとCookieの違いを説明してください。

【Session】
・サーバが一時的に保持している情報

【Cookie】
・ブラウザが一時的に保持している情報

### `setToken()`が何をしているか説明してください。

・「$_SESSION」の「token」キーにランダムな16文字の値を格納している。

### `checkToken()`が何をしているか説明してください。

・「$_SESSION」の「token」キーの値が空だった、または「$_SESSION」の「token」キーの値が$tokenと異なっていた場合
「$_SESSION」の「err」キーに「不正な操作です」というメッセージを格納する。
その後、直前のページにリダイレクトする。

### トークンを使うことでなぜCSRFが防げるのか説明してください。

・セッションやcookieを使ってページにアクセスした際に、一緒にtokenの認証を行うことで
もしtokenの値が異なっている場合、弾かれるようになっているため不正アクセスができなくなるから。

## SQLインジェクション

### SQLインジェクションとはどんな攻撃か、また攻撃者にどんなメリットがあるか説明してください。

・入力ボックスなどにSQL文を打ち込み、DB上で不正な操作を行うこと（レコード全削除など）

【攻撃者のメリット】
・DBに保存されているデータの改ざん、盗難が行える

### `->prepare()`の返り値と、またこのメソッドが何をしているか説明してください。

・PDOStatement オブジェクトを返す。falseの場合はPDOExceptionを返す。
・変動値を含むSQL文を実行するためのメソッド。「:todoText」のようなプレースホルダが必要。

### `->bindValue()`が何をしているか説明してください。

・変数の値をバインドするための関数。

### 今回の対策でなぜSQLインジェクションが防げるのか説明してください。

・入力されたSQL文を文字列として認識させることができるため。

## バリデーション

### バリデーションの目的について説明してください。

・各入力内容に制限を設けるため（文字数、入力必須など）。

### `validate()`が何をしているか説明してください。

・contentに内容が入っているが、空文字だった時「$_SESSION」のerrキーに入力がありませんが挿入される。
その後、直前に開いていたページに遷移される。

### `isset($post['content'])`はなぜ必要か、無い場合どうなるか説明してください。

・contentが空でも送信ができてしまう。

## その他

### `unsetError()`を実行しないとどうなるか説明してください。

・$_SESSION['err']の中のエラーメッセージが削除されないので、正常な場合でもエラーメッセージが表示されてしまう。